### YamlMime:DocDB
type: View
id: view.sales.vsalespersonsalesbyfiscalyears
description: Uses PIVOT to return aggregated sales information for each sales representative.
createdAt: 2023-05-08T12:07:39.5630000
lastModifiedAt: 2023-05-08T12:07:39.5630000
name: Sales.vSalesPersonSalesByFiscalYears
indexes: []
columns:
- type: ViewColumn
  id: view.sales.vsalespersonsalesbyfiscalyears.column.salespersonid
  description: 
  createdAt: 0001-01-01T00:00:00.0000000
  lastModifiedAt: 0001-01-01T00:00:00.0000000
  name: SalesPersonID
  dataType: INT
  maxLengthBytes: 4
  precision: 10
  scale: 0
  isComputed: false
  computedText: ''
  isIdentity: false
  identityIncrement: 0
  identitySeed: 0
  inPrimaryKey: false
  isForeignKey: false
  default: 
  script: ""
- type: ViewColumn
  id: view.sales.vsalespersonsalesbyfiscalyears.column.fullname
  description: 
  createdAt: 0001-01-01T00:00:00.0000000
  lastModifiedAt: 0001-01-01T00:00:00.0000000
  name: FullName
  dataType: NVARCHAR(152)
  maxLengthBytes: 152
  precision: 0
  scale: 0
  isComputed: false
  computedText: ''
  isIdentity: false
  identityIncrement: 0
  identitySeed: 0
  inPrimaryKey: false
  isForeignKey: false
  default: 
  script: ""
- type: ViewColumn
  id: view.sales.vsalespersonsalesbyfiscalyears.column.jobtitle
  description: 
  createdAt: 0001-01-01T00:00:00.0000000
  lastModifiedAt: 0001-01-01T00:00:00.0000000
  name: JobTitle
  dataType: NVARCHAR(50)
  maxLengthBytes: 50
  precision: 0
  scale: 0
  isComputed: false
  computedText: ''
  isIdentity: false
  identityIncrement: 0
  identitySeed: 0
  inPrimaryKey: false
  isForeignKey: false
  default: 
  script: ""
- type: ViewColumn
  id: view.sales.vsalespersonsalesbyfiscalyears.column.salesterritory
  description: 
  createdAt: 0001-01-01T00:00:00.0000000
  lastModifiedAt: 0001-01-01T00:00:00.0000000
  name: SalesTerritory
  dataType: NAME
  maxLengthBytes: 50
  precision: 0
  scale: 0
  isComputed: false
  computedText: ''
  isIdentity: false
  identityIncrement: 0
  identitySeed: 0
  inPrimaryKey: false
  isForeignKey: false
  default: 
  script: ""
- type: ViewColumn
  id: view.sales.vsalespersonsalesbyfiscalyears.column.2002
  description: 
  createdAt: 0001-01-01T00:00:00.0000000
  lastModifiedAt: 0001-01-01T00:00:00.0000000
  name: 2002
  dataType: MONEY
  maxLengthBytes: 8
  precision: 19
  scale: 4
  isComputed: false
  computedText: ''
  isIdentity: false
  identityIncrement: 0
  identitySeed: 0
  inPrimaryKey: false
  isForeignKey: false
  default: 
  script: ""
- type: ViewColumn
  id: view.sales.vsalespersonsalesbyfiscalyears.column.2003
  description: 
  createdAt: 0001-01-01T00:00:00.0000000
  lastModifiedAt: 0001-01-01T00:00:00.0000000
  name: 2003
  dataType: MONEY
  maxLengthBytes: 8
  precision: 19
  scale: 4
  isComputed: false
  computedText: ''
  isIdentity: false
  identityIncrement: 0
  identitySeed: 0
  inPrimaryKey: false
  isForeignKey: false
  default: 
  script: ""
- type: ViewColumn
  id: view.sales.vsalespersonsalesbyfiscalyears.column.2004
  description: 
  createdAt: 0001-01-01T00:00:00.0000000
  lastModifiedAt: 0001-01-01T00:00:00.0000000
  name: 2004
  dataType: MONEY
  maxLengthBytes: 8
  precision: 19
  scale: 4
  isComputed: false
  computedText: ''
  isIdentity: false
  identityIncrement: 0
  identitySeed: 0
  inPrimaryKey: false
  isForeignKey: false
  default: 
  script: ""
script: |+
  SET ANSI_NULLS ON
  GO

  SET QUOTED_IDENTIFIER ON
  GO

  CREATE VIEW [Sales].[vSalesPersonSalesByFiscalYears]
  AS
  SELECT
      pvt.[SalesPersonID]
      ,pvt.[FullName]
      ,pvt.[JobTitle]
      ,pvt.[SalesTerritory]
      ,pvt.[2002]
      ,pvt.[2003]
      ,pvt.[2004]
  FROM (SELECT
          soh.[SalesPersonID]
          ,p.[FirstName] + ' ' + COALESCE(p.[MiddleName], '') + ' ' + p.[LastName] AS [FullName]
          ,e.[JobTitle]
          ,st.[Name] AS [SalesTerritory]
          ,soh.[SubTotal]
          ,YEAR(DATEADD(m, 6, soh.[OrderDate])) AS [FiscalYear]
      FROM [Sales].[SalesPerson] sp
          INNER JOIN [Sales].[SalesOrderHeader] soh
          ON sp.[BusinessEntityID] = soh.[SalesPersonID]
          INNER JOIN [Sales].[SalesTerritory] st
          ON sp.[TerritoryID] = st.[TerritoryID]
          INNER JOIN [HumanResources].[Employee] e
          ON soh.[SalesPersonID] = e.[BusinessEntityID]
  		INNER JOIN [Person].[Person] p
  		ON p.[BusinessEntityID] = sp.[BusinessEntityID]
  	 ) AS soh
  PIVOT
  (
      SUM([SubTotal])
      FOR [FiscalYear]
      IN ([2002], [2003], [2004])
  ) AS pvt;

  GO

